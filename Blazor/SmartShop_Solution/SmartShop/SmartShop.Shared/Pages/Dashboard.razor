@using SmartShop.Shared.Services
@inject IFormFactor FormFactor
@inject NavigationManager Navigation

<PageTitle>لوحة التحكم - البقالة الذكية</PageTitle>

<div class="page-content">
    <!-- Stats Grid -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">
                <i data-lucide="package"></i>
            </div>
            <div class="stat-content">
                <div class="stat-label">إجمالي المنتجات</div>
                <div class="stat-value">@totalProducts</div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i data-lucide="wallet"></i>
            </div>
            <div class="stat-content">
                <div class="stat-label">قيمة المخزون</div>
                <div class="stat-value">
                    <div class="primary-value">
                        <span>@inventoryValueYER.ToString("N0")</span>
                        <span class="currency">ر.ي</span>
                    </div>
                    <div class="secondary-value">
                        <span>≈ @((inventoryValueYER / exchangeRate).ToString("N0"))</span>
                        <span class="currency">ر.س</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="stat-card shortage-card" @onclick="NavigateToShortage">
            <div class="stat-icon">
                <i data-lucide="alert-triangle"></i>
            </div>
            <div class="stat-content">
                <div class="stat-label">المنتجات الناقصة</div>
                <div class="stat-value">@shortageCount</div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i data-lucide="trending-up"></i>
            </div>
            <div class="stat-content">
                <div class="stat-label">الربح اليومي</div>
                <div class="stat-value">
                    <div class="primary-value">
                        <span>@dailyProfitYER.ToString("N0")</span>
                        <span class="currency">ر.ي</span>
                    </div>
                    <div class="secondary-value">
                        <span>≈ @((dailyProfitYER / exchangeRate).ToString("N0"))</span>
                        <span class="currency">ر.س</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="main-grid">
        <!-- Exchange Rate Card -->
        <div class="card exchange-rate-card">
            <div class="card-header">
                <h2 class="card-title">
                    <i data-lucide="dollar-sign"></i>
                    <span>سعر الصرف الحالي</span>
                </h2>
            </div>
            <div class="card-content">
                <div class="exchange-rate-display">
                    <div class="rate-value">
                        <span>@exchangeRate.ToString("N0")</span>
                        <span class="currency">ر.ي</span>
                    </div>
                    <div class="rate-description">
                        سعر الريال السعودي الواحد بالريال اليمني
                    </div>
                    <div class="rate-examples">
                        <div class="rate-example">
                            <div class="example-label">10 ر.س</div>
                            <div class="example-value">@((10 * exchangeRate).ToString("N0"))</div>
                        </div>
                        <div class="rate-example">
                            <div class="example-label">50 ر.س</div>
                            <div class="example-value">@((50 * exchangeRate).ToString("N0"))</div>
                        </div>
                        <div class="rate-example">
                            <div class="example-label">100 ر.س</div>
                            <div class="example-value">@((100 * exchangeRate).ToString("N0"))</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Updates Card -->
        <div class="card recent-updates-card">
            <div class="card-header">
                <h2 class="card-title">آخر تحديثات الأسعار</h2>
            </div>
            <div class="card-content">
                <div class="updates-list">
                    @foreach (var update in recentUpdates)
                    {
                        <div class="update-item">
                            <div class="update-info">
                                <div class="product-name">@update.ProductName</div>
                                <div class="update-date">@update.Date.ToString("yyyy-MM-dd")</div>
                            </div>
                            <div class="update-price">
                                <div class="new-price">@update.NewPrice.ToString("N0") ر.ي</div>
                                <div class="price-change @(update.Change > 0 ? "positive" : "negative")">
                                    @(update.Change > 0 ? "+" : "")@update.Change.ToString("N0") ر.ي
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Coming Soon Section -->
    <div class="card coming-soon-card">
        <div class="card-header">
            <h2 class="card-title">
                <span>الإصدار الثاني - ميزات متقدمة</span>
                <span class="badge">قريباً</span>
            </h2>
            <p class="card-description">ميزات جديدة ومتطورة لإدارة أفضل لمتجرك</p>
        </div>
        <div class="card-content">
            <div class="coming-soon-grid">
                @foreach (var feature in comingSoonFeatures)
                {
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i data-lucide="@feature.Icon"></i>
                        </div>
                        <div class="feature-content">
                            <h3>@feature.Title</h3>
                            <p>@feature.Subtitle</p>
                            <small>@feature.Description</small>
                        </div>
                    </div>
                }
            </div>
            <div class="coming-soon-notice">
                🚀 ستكون هذه الميزات متاحة في الإصدار الثاني من النظام
            </div>
        </div>
    </div>
</div>

@code {
    private int totalProducts = 20;
    private decimal inventoryValueYER = 2450000;
    private int shortageCount = 4;
    private decimal dailyProfitYER = 125000;
    private decimal exchangeRate = 680;

    private List<PriceUpdate> recentUpdates = new();
    private List<ComingSoonFeature> comingSoonFeatures = new();

    protected override void OnInitialized()
    {
        LoadRecentUpdates();
        LoadComingSoonFeatures();
    }

    private void LoadRecentUpdates()
    {
        recentUpdates = new List<PriceUpdate>
        {
            new PriceUpdate { ProductName = "سكر أبيض", Date = DateTime.Now.AddDays(-1), NewPrice = 6280, Change = 500 },
            new PriceUpdate { ProductName = "أرز بسمتي", Date = DateTime.Now.AddDays(-2), NewPrice = 8960, Change = 800 },
            new PriceUpdate { ProductName = "زيت دوار الشمس", Date = DateTime.Now.AddDays(-3), NewPrice = 11540, Change = 1000 }
        };
    }

    private void LoadComingSoonFeatures()
    {
        comingSoonFeatures = new List<ComingSoonFeature>
        {
            new ComingSoonFeature 
            { 
                Icon = "database", 
                Title = "إدارة المخزون المتقدمة", 
                Subtitle = "تتبع دقيق للمخزون", 
                Description = "إشعارات ذكية وتحليلات متقدمة" 
            },
            new ComingSoonFeature 
            { 
                Icon = "bar-chart-3", 
                Title = "تقارير وتحليلات", 
                Subtitle = "تقارير شاملة", 
                Description = "رسوم بيانية وإحصائيات مفصلة" 
            },
            new ComingSoonFeature 
            { 
                Icon = "users", 
                Title = "إدارة العملاء", 
                Subtitle = "نظام العملاء", 
                Description = "نقاط الولاء والمدفوعات الآجلة" 
            },
            new ComingSoonFeature 
            { 
                Icon = "file-text", 
                Title = "الالتزامات المالية", 
                Subtitle = "إدارة المصروفات", 
                Description = "رواتب، إيجارات، فواتير الخدمات" 
            }
        };
    }

    private void NavigateToShortage()
    {
        Navigation.NavigateTo("/shortage");
    }

    public class PriceUpdate
    {
        public string ProductName { get; set; } = string.Empty;
        public DateTime Date { get; set; }
        public decimal NewPrice { get; set; }
        public decimal Change { get; set; }
    }

    public class ComingSoonFeature
    {
        public string Icon { get; set; } = string.Empty;
        public string Title { get; set; } = string.Empty;
        public string Subtitle { get; set; } = string.Empty;
        public string Description { get; set; } = string.Empty;
    }
}